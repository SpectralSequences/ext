!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=4)}([function(e,t,s){"use strict";function i(e,t){let s=[];for(let i=0;i<e.length;i++)switch(e[i]){case 0:break;case 1:s.push(t[i]);break;default:s.push(`${e[i]} ${t[i]}`)}return s.join(" + ")}function n(e){return katex.renderToString(r(e))}function a(e){return katex.renderToString("\\begin{bmatrix}"+e.map(e=>e.join("&")).join("\\\\")+"\\end{bmatrix}")}function r(e){return"\\begin{bmatrix}"+e.join("&")+"\\end{bmatrix}"}function l(e){let t=e.split(/(?:\\\[)|(?:\\\()|(?:\\\))|(?:\\\])|(?:\$)/);for(let e=1;e<t.length;e+=2)t[e]=katex.renderToString(t[e],{throwOnError:!1});return t.join("\n")}function o(e,t,s){for(;;){let i=prompt(e);if(!i)return null;try{let e=JSON.parse(i.trim());if(Array.isArray(e)&&e.length==s&&e.reduce((e,t)=>e&&Number.isInteger(t),!0))return e}catch(e){}alert(t)}}function h(e,t){for(;;){let s=prompt(e);if(!s)return null;let i=parseInt(s.trim());if(!isNaN(i))return i;alert(t)}}function d(e,t,s="text/plain"){Array.isArray(t)||(t=[t]);let i=document.createElement("a");i.href=URL.createObjectURL(new Blob(t,{type:s})),i.download=e,i.rel="noopener",i.dispatchEvent(new MouseEvent("click")),setTimeout(()=>URL.revokeObjectURL(i.href),6e4)}function c(e){return new TextDecoder("utf-8").decode(pako.inflate(e))}function u(e){return pako.deflate(e,{level:1})}s.d(t,"j",function(){return i}),s.d(t,"h",function(){return n}),s.d(t,"d",function(){return a}),s.d(t,"i",function(){return r}),s.d(t,"g",function(){return l}),s.d(t,"e",function(){return o}),s.d(t,"f",function(){return h}),s.d(t,"b",function(){return d}),s.d(t,"c",function(){return c}),s.d(t,"a",function(){return u})},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",function(){return MIN_PAGE}),__webpack_require__.d(__webpack_exports__,"a",function(){return ExtSseq});var _utils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);const MIN_PAGE=2,KEEP_LOG=new Set(["AddDifferential","AddProductType","AddProductDifferential","AddPermanentClass","SetClassName"]);class BiVec{constructor(e,t){this.data=t||[],this.minDegree=e}set(e,t,s){for(;this.data.length<=e-this.minDegree;)this.data.push([]);this.data[e-this.minDegree][t]=s}get(e,t){return e<0||t<0||this.data.length<=e-this.minDegree?void 0:this.data[e-this.minDegree][t]}}class ExtSseq extends EventEmitter{constructor(e,t){super(),this.minDegree=t,this.maxDegree=t,this.history=[],this.redoStack=[],this.name=e,this._vanishingSlope="1/2",this._vanishingIntercept=1,this.classes=new BiVec(t),this.classState=new BiVec(t),this.permanentClasses=new BiVec(t),this.classNames=new BiVec(t),this.decompositions=new BiVec(t),this.products=new Map,this.structlineTypes=new Set,this.differentials=new BiVec(t),this.trueDifferentials=new BiVec(t),this.pageList=[MIN_PAGE],this.maxMultX=0,this.maxMultY=0,this.maxDiffPage=0}get vanishingSlope(){return this._vanishingSlope}get vanishingIntercept(){return this._vanishingIntercept}set vanishingSlope(e){this._vanishingSlope=e,this.emit("update")}set vanishingIntercept(e){this._vanishingIntercept=e,this.emit("update")}get maxX(){return this.maxDegree}send(e,t=!0){KEEP_LOG.has(Object.keys(e.action)[0])&&(this.emit("new-history",e),t&&this.history.push(e)),e.sseq=this.name,window.send(e)}removeHistoryItem(e){if(e=JSON.stringify(e),confirm(`Are you sure you want to remove ${e}?`)){this.history=this.history.filter(t=>JSON.stringify(t)!=e),this.block(),this.send({recipients:["Sseq"],action:{Clear:{}}}),this.emit("clear-history");for(let e of this.history)this.send(e,!1);this.block(!1)}}block(e=!0){this.send({recipients:["Sseq"],action:{BlockRefresh:{block:e}}})}undo(){this.redoStack.push(this.history.pop()),this.block(),this.send({recipients:["Sseq"],action:{Clear:{}}}),this.emit("clear-history");for(let e of this.history)this.send(e,!1);this.block(!1)}redo(){this.send(this.redoStack.pop())}addPermanentClass(e,t,s){this.send({recipients:["Sseq"],action:{AddPermanentClass:{x:e,y:t,class:s}}})}pageBasisToE2Basis(e,t,s,i){let n=this.classes.get(t,s)[0].length,a=this.getClasses(t,s,e),r=[];for(let e=0;e<n;e++)r.push(0);for(let e=0;e<a.length;e++){let t=i[e];for(let s=0;s<n;s++)r[s]+=t*a[e][s]}for(let e=0;e<n;e++)r[e]=r[e]%this.p;return r}addDifferentialInteractive(e,t){let s=t[1]-e[1],i=this.getClasses(e[0],e[1],s).length,n=this.getClasses(t[0],t[1],s).length,a=[],r=[];if(1==i)a=[1];else if(null===(a=Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.e)("Input source",`Invalid source. Express in terms of basis on page ${s}`,i)))return;if(1==i&&1==n)if(2==this.p)r=[1];else{let e=Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.f)("Coefficient of differential","Invalid coefficient. Write down a single number.");if(null===e)return;r=[e]}else if(null===(r=Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.e)("Input target",`Invalid target. Express in terms of basis on page ${s}`,n)))return;a=this.pageBasisToE2Basis(s,e[0],e[1],a),r=this.pageBasisToE2Basis(s,e[0]-1,e[1]+s,r),this.addDifferential(s,e[0],e[1],a,r)}setClassName(e,t,s,i){this.send({recipients:["Sseq"],action:{SetClassName:{x:e,y:t,idx:s,name:i}}})}addProductInteractive(e,t,s){let i;i=1==s&&2==this.p?[1]:Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.e)("Input class","Invalid class. Express in terms of basis on E_2 page",s);let n=prompt("Name for product",this.isUnit?Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.j)(i,this.classNames.get(e,t)):void 0);if(null===n)return;let a=confirm("Permanent class?");this.send({recipients:["Sseq","Resolver"],action:{AddProductType:{permanent:a,x:e,y:t,class:i,name:n}}})}addProductDifferentialInteractive(e,t,s,i,n){if(!i){let s=this.getClasses(e,t,MIN_PAGE).length;i=1==s&&2==this.p?[1]:Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.e)("Enter source class","Invalid class. Express in terms of basis on E2",s)}if(!n){let i=this.getClasses(e-1,t+s,MIN_PAGE).length;n=1==i&&2==this.p?[1]:Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.e)("Enter target class","Invalid class. Express in terms of basis on E2",i)}i&&n&&window.mainSseq.send({recipients:["Sseq","Resolver"],action:{AddProductDifferential:{source:{permanent:!1,x:e,y:t,class:i,name:prompt("Name of source",this.isUnit?Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.j)(i,this.classNames.get(e,t)):void 0).trim()},target:{permanent:!1,x:e-1,y:t+s,class:n,name:prompt("Name of target",this.isUnit?Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.j)(n,this.classNames.get(e-1,t+s)):void 0).trim()}}}})}addPermanentClassInteractive(e,t){let s,i=this.classes.get(e,t);0==i[i.length-1].length?alert("There are no surviving classes. Action ignored"):1==i[0].length?this.addPermanentClass(e,t,i[0][0]):s=Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.e)("Input new permanent class","Invalid class. Express in terms of basis on E_2 page",i[0].length),s&&this.addPermanentClass(e,t,s)}addDifferential(e,t,s,i,n){this.send({recipients:["Sseq"],action:{AddDifferential:{r:e,x:t,y:s,source:i,target:n}}})}resolveFurther(e){if(!Number.isInteger(e)){if(null===(e=prompt("New maximum degree",this.maxDegree+10)))return;e=parseInt(e.trim())}e<=this.maxDegree||(this.maxDegree=e,this.block(),this.send({recipients:["Resolver"],action:{Resolve:{max_degree:e}}}),this.block(!1))}queryTable(e,t){t<0||this.send({recipients:["Resolver"],action:{QueryTable:{s:t,t:e+t}}},!1)}get maxY(){let realSlope=1/(1/eval(this._vanishingSlope)+1);return Math.ceil((this.maxDegree-this.minDegree)*realSlope+1+eval(this._vanishingIntercept))}processResolving(e){this.p=e.p,this.maxDegree=e.max_degree}processSetPageList(e){this.pageList=e.page_list}processSetClass(e){let t=e.x,s=e.y,i=e.classes;this.classes.set(t,s,i),this.classState.set(t,s,e.state),this.permanentClasses.set(t,s,e.permanents),this.classNames.set(t,s,e.class_names),this.decompositions.set(t,s,e.decompositions),this.emit("update",t,s)}processSetDifferential(e){let t=e.x,s=e.y;this.differentials.set(t,s,e.differentials),this.trueDifferentials.set(t,s,e.true_differentials),this.emit("update",t,s)}processSetStructline(e){let t=e.x,s=e.y;for(let i of e.structlines){this.products.has(i.name)||(this.products.set(i.name,{x:i.mult_x,y:i.mult_y,matrices:new BiVec(this.minDegree)}),this.emit("new-structline",i.name)),this.products.get(i.name).matrices.set(t,s,i.matrices)}this.emit("update",t,s)}getDifferentials(e,t,s){let i=this.differentials.get(e,t);if(i)return i[s-MIN_PAGE]}hasClasses(e,t,s){let i=this.getClasses(e,t,s);return void 0!==i&&i.length>0}getClasses(e,t,s){s-=MIN_PAGE;let i=this.classes.get(e,t);if(i)return s>=i.length&&(s=i.length-1),i[s]}getChangingJSON(){let e={};for(let t of CHANGING_FIELDS)e[t]=this[t];for(let t of CHANGING_BIVECS)e[t]=this[t].data;return e.products=Object.fromEntries(this.products),Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.a)(JSON.stringify(e))}async downloadHistoryList(){this.display.updating=!0;let e=this.history;this.history=[];let t=[],s={};for(let e of PERMANENT_FIELDS)s[e]=this[e];for(let e of PERMANENT_BIVECS)s[e]=this[e].data;s.name=prompt("Name of spectral sequence"),t.push(Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.a)(JSON.stringify(s))),this.send({recipients:["Sseq"],action:{Clear:{}}});let i=[[]],n=e[Symbol.iterator](),a=n.next();for(;!a.done;){let e=Object.keys(a.value.action)[0];if("SetClassName"==e||"AddProductType"==e&&!a.value.action[e].permanent){a=n.next();continue}let s=[];await new Promise(e=>window.onComplete.push(e)),this.block();do{if(this.send(a.value),s.push(a.value),!a.value.skip){a=n.next();break}a=n.next()}while(!a.done);this.block(!1),i.push(s),t.push(this.getChangingJSON())}await new Promise(e=>window.onComplete.push(e)),t.push(this.getChangingJSON());let r=prompt("History file name");if(null===r)return;r=r.trim(),t.splice(1,0,Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.a)(i.map(JSON.stringify).join("\n")));let l=t.map(e=>e.length);l.push(0),Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.b)(r,[Uint32Array.from(l)].concat(t),"application/octet-stream"),this.history=e,this.display.updating=!1}static fromBinary(e){let t=JSON.parse(Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.c)(e)),s=new ExtSseq("Main",t.minDegree);Object.defineProperty(s,"maxX",{value:null,writable:!0}),Object.defineProperty(s,"maxY",{value:null,writable:!0});for(let e of PERMANENT_FIELDS)s[e]=t[e];for(let e of PERMANENT_BIVECS)s[e].data=t[e];return s.moduleName=t.name,s}updateFromBinary(e){let t=JSON.parse(Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.c)(e));for(let e of CHANGING_FIELDS)this[e]=t[e];for(let e of CHANGING_BIVECS)this[e].data=t[e];this.products=new Map(Object.entries(t.products));for(let[e,t]of this.products)t.matrices=new BiVec(this.minDegree,t.matrices.data)}}const PERMANENT_FIELDS=["minDegree","maxX","maxY","isUnit"],PERMANENT_BIVECS=["classNames","decompositions"],CHANGING_FIELDS=["pageList"],CHANGING_BIVECS=["classes","classState","permanentClasses","differentials","trueDifferentials"]},function(e,t,s){"use strict";var i=s(3),n=s(0),a=s(1);const r=10;class l{constructor(e){this.display=e,this.div=document.createElement("div"),this.div.style.opacity=0,this.div.style.position="absolute",this.div.style["z-index"]=999999,this.div.className="tooltip",document.body.appendChild(this.div)}setHTML(e){this.div.innerHTML=e}show(e,t){this.div.style.left="0px",this.div.style.top="0px";let s=this.div.getBoundingClientRect(),i=this.display.canvas.getBoundingClientRect();e+=i.x,t+=i.y,e+r+s.width<window.innerWidth?e+=r:e=e-s.width-r,t-s.height-r>0?t=t-s.height-r:t+=r,this.div.style.left=`${e}px`,this.div.style.top=`${t}px`,this.div.style.transition="opacity 200ms",this.div.style.opacity=.9}hide(){this.div.style.transition="opacity 500ms",this.div.style.opacity=0}}s.d(t,"b",function(){return o}),s.d(t,"c",function(){return h}),s.d(t,"a",function(){return E}),s.d(t,"d",function(){return w});const o=1,h=2,d=.3,c=["cyan","red","green"],u="blue",p={InProgress:"black",Error:"#a6001a",Done:"gray"},m="go",_="chess",g={color:"black",bend:0,"line-dash":[]},f=20,y=60;class v extends EventEmitter{constructor(e,t){super(),this.leftMargin=40,this.rightMargin=5,this.topMargin=30,this.bottomMargin=30,this.domainOffset=.5,this.specialClasses=new Set,this.highlighted=new Set,this.tooltip=new l(this),this.gridStyle=m,this.gridColor="#c6c6c6",this.gridStrokeWidth=.3,this.TICK_STEP_LOG_BASE=1.1,this.visibleStructlines=new Set(["h_0","a_0","h_1","h_2"]),this.structlineStyles=new Map,this.updating=!1,this.container=d3.select(e),this.container_DOM=this.container.node(),this.container.selectAll().remove(),this.xScaleInit=d3.scaleLinear(),this.yScaleInit=d3.scaleLinear(),this.canvas=document.createElement("canvas"),this.canvas.style.padding="0px",this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.container_DOM.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.update=this.update.bind(this),this.nextPage=this.nextPage.bind(this),this.previousPage=this.previousPage.bind(this),this._onMousemove=this._onMousemove.bind(this),this.zoom=d3.zoom().scaleExtent([0,4]),this.zoom.on("zoom",this.update),this.zoomD3Element=d3.select(this.canvas),this.zoomD3Element.call(this.zoom).on("dblclick.zoom",null),this.canvas.addEventListener("mousemove",this._onMousemove),this.canvas.addEventListener("click",()=>this._onClick(this.mouseCoord)),this.classScale=1,window.addEventListener("resize",()=>this.resize()),t&&this.setSseq(t)}resize(e,t){if(!this.sseq)return;let s=this.xminFloat,i=this.yminFloat;this._initializeCanvas(e,t),this._updateScale();let n=this.xminFloat-s,a=this.yminFloat-i;this.zoom.on("zoom",null),this.zoom.translateBy(this.zoomD3Element,this.dxScale(n),this.dyScale(a)),this.zoom.on("zoom",this.update),this.update()}_initializeCanvas(e,t){const s=this.container_DOM.getBoundingClientRect(),i=e||.99*s.width,n=t||.97*s.height;this.canvasWidth=i,this.canvasHeight=n,this.canvas.width=i,this.canvas.height=n,this.clipWidth=this.canvasWidth-this.rightMargin,this.clipHeight=this.canvasHeight-this.bottomMargin,this.plotWidth=this.canvasWidth-this.leftMargin-this.rightMargin,this.plotHeight=this.canvasHeight-this.bottomMargin-this.topMargin,this.xScaleInit=this.xScaleInit.range([this.leftMargin,this.clipWidth]),this.yScaleInit=this.yScaleInit.range([this.clipHeight,this.topMargin])}setSseq(e){this.sseq&&this.sseq.removeListener("update",this.update),this.sseq=e,this.sseq.display=this,this.pageIdx=0,this.setPage(),this._initializeScale(),this._initializeCanvas(),this.sseq.on("update",this.update);for(let t of e.products.keys())this.structlineStyles.set(t,Object.assign({},g));this.sseq.on("new-structline",e=>{this.structlineStyles.set(e,Object.assign({},g))}),this.update()}_initializeScale(){this.xScaleInit.domain([this.sseq.minDegree-this.domainOffset,this.sseq.maxX+this.domainOffset]),this.yScaleInit.domain([0-this.domainOffset,this.sseq.maxY+this.domainOffset])}nextPage(){this.pageIdx<this.sseq.pageList.length-1&&(this.setPage(this.pageIdx+1),this.update())}previousPage(){this.pageIdx>0&&(this.setPage(this.pageIdx-1),this.update())}setSpecialClasses(e){this.specialClasses.clear();for(let t of e)this.specialClasses.add(t.join(" "))}clearHighlight(){this.highlighted.clear(),this.selected&&this.highlightClass(this.selected)}removeHighlight(e){this.highlighted.delete(e.join(" ")),this.selected&&this.highlightClass(this.selected)}highlightClass(e){this.highlighted.add(e.join(" "))}setPage(e){this.sseq&&(void 0!==e&&(this.pageIdx=e),this.page=this.sseq.pageList[this.pageIdx],this._onClick(this.selected))}update(){this.sseq&&(this.updating||(this.updating=!0,requestAnimationFrame(()=>{this.updating=!1,this._drawSseq(this.context),d3.event?this._onMousemove(d3.event):this._onMousemove()})))}clipContext(e){e.beginPath(),e.globalAlpha=0,e.rect(this.leftMargin,this.topMargin,this.plotWidth,this.plotHeight),e.stroke(),e.clip(),e.globalAlpha=1}_drawSseq(e=this.context){this.sseq&&(this._updateScale(),this._updateGridAndTickStep(),e.clearRect(0,0,this.canvasWidth,this.canvasHeight),this._drawTicks(e),this._drawAxes(e),e.save(),this.clipContext(e),this._drawGrid(e),this._drawStructlines(e),this._drawDifferentials(e),this._drawNodes(e),e.restore())}_updateScale(){let e=this.zoomD3Element,t=d3.zoomTransform(e.node()),s=t.k,i=t.rescaleX(this.xScaleInit),n=t.rescaleY(this.yScaleInit);this.zoom.on("zoom",null);let a=!1,r=!1;if(i(this.sseq.maxX-this.sseq.minDegree+2*this.domainOffset)-i(0)<this.plotWidth?a=!0:i(this.sseq.minDegree-this.domainOffset)>this.leftMargin?this.zoom.translateBy(e,(this.leftMargin-i(this.sseq.minDegree-this.domainOffset))/s,0):i(this.sseq.maxX+this.domainOffset)<this.clipWidth&&this.zoom.translateBy(e,(this.clipWidth-i(this.sseq.maxX+this.domainOffset))/s,0),n(0)-n(this.sseq.maxY+2*this.domainOffset)<this.plotHeight?r=!0:n(-this.domainOffset)<this.clipHeight?this.zoom.translateBy(e,0,(this.clipHeight-n(-this.domainOffset))/s):n(this.sseq.maxY+this.domainOffset)>this.topMargin&&this.zoom.translateBy(e,0,this.topMargin-n(this.sseq.maxY+this.domainOffset)/s),a&&r){if(this.oldScalesMaxed&&s<this.scale)return this.zoom.transform(e,this.transform),void this.zoom.on("zoom",this.update);this.oldScalesMaxed=!0}else this.oldScalesMaxed=!1;this.transform=d3.zoomTransform(e.node()),this.scale=this.transform.k,this.xScale=this.transform.rescaleX(this.xScaleInit),this.yScale=this.transform.rescaleY(this.yScaleInit),a&&this.xScale.domain([this.sseq.minDegree-this.domainOffset,this.sseq.maxX+this.domainOffset]),r&&this.yScale.domain([-this.domainOffset,this.sseq.maxY+this.domainOffset]),this.xminFloat=this.xScale.invert(this.leftMargin),this.xmaxFloat=this.xScale.invert(this.clipWidth),this.yminFloat=this.yScale.invert(this.clipHeight),this.ymaxFloat=this.yScale.invert(this.topMargin),this.xmin=Math.ceil(this.xminFloat),this.xmax=Math.floor(this.xmaxFloat),this.ymin=Math.ceil(this.yminFloat),this.ymax=Math.floor(this.ymaxFloat),this.zoom.on("zoom",this.update)}dxScale(e){return this.xScale(e)-this.xScale(0)}dyScale(e){return this.yScale(e)-this.yScale(0)}sseqToCanvas(e,t,s,i){return void 0===s&&void 0===i&&(s=0,i=1),[this.xScale(e+(s-(i-1)/2)*d),this.yScale(t)]}canvasToSseq(e,t){return[Math.round(this.xScale.invert(e)),Math.round(this.yScale.invert(t))]}_updateGridAndTickStep(){this.xTicks=this.xScale.ticks(this.canvasWidth/70),this.yTicks=this.yScale.ticks(this.canvasHeight/70),this.xTickStep=Math.ceil(this.xTicks[1]-this.xTicks[0]),this.yTickStep=Math.ceil(this.yTicks[1]-this.yTicks[0]),this.xTicks[0]-=this.xTickStep,this.yTicks[0]-=this.yTickStep,this.xTicks.push(this.xTicks[this.xTicks.length-1]+this.xTickStep),this.yTicks.push(this.yTicks[this.yTicks.length-1]+this.yTickStep),this.xGridStep=0===Math.floor(this.xTickStep/5)?1:Math.floor(this.xTickStep/5),this.yGridStep=0===Math.floor(this.yTickStep/5)?1:Math.floor(this.yTickStep/5),this.sseq.squareAspectRatio&&(this.xGridStep=1,this.yGridStep=this.xGridStep)}_drawTicks(e){e.save(),e.textBaseline="middle",e.font="15px Arial",e.textAlign="center";for(let t=Math.floor(this.xTicks[0]);t<=this.xTicks[this.xTicks.length-1];t+=this.xTickStep)e.fillText(t,this.xScale(t),this.clipHeight+20);e.textAlign="right";for(let t=Math.floor(this.yTicks[0]);t<=this.yTicks[this.yTicks.length-1];t+=this.yTickStep)e.fillText(t,this.leftMargin-10,this.yScale(t));e.restore()}_drawGrid(e){switch(e.save(),e.strokeStyle=this.gridColor,e.lineWidth=this.gridStrokeWidth,this.gridStyle){case m:this._drawGridWithOffset(e,0,0);break;case _:this._drawGridWithOffset(e,.5,.5)}e.restore()}_drawGridWithOffset(e,t,s){e.beginPath();for(let s=Math.floor(this.xmin/this.xGridStep)*this.xGridStep-t;s<=this.xmax;s+=this.xGridStep)e.moveTo(this.xScale(s),0),e.lineTo(this.xScale(s),this.clipHeight);e.stroke(),e.beginPath();for(let t=Math.floor(this.ymin/this.yGridStep)*this.yGridStep-s;t<=this.ymax;t+=this.yGridStep)e.moveTo(this.leftMargin,this.yScale(t)),e.lineTo(this.canvasWidth-this.rightMargin,this.yScale(t));e.stroke()}_drawAxes(e){e.clearRect(0,0,this.leftMargin,this.topMargin),e.clearRect(0,this.clipHeight,this.leftMargin,this.bottomMargin),e.save(),e.beginPath(),e.moveTo(this.leftMargin,this.topMargin),e.lineTo(this.leftMargin,this.clipHeight),e.lineTo(this.canvasWidth-this.rightMargin,this.clipHeight),e.stroke(),e.restore()}_drawNodes(e){e.save();let t=Math.max(Math.min(this.dxScale(1),-this.dyScale(1),y),f)*this.classScale;for(let s=this.xmin-1;s<this.xmax+1;s++)for(let i=this.ymin-1;i<this.ymax+1;i++){let n=this.sseq.getClasses(s,i,this.page);if(void 0===n)continue;this.highlighted.has(`${s} ${i}`)?e.fillStyle="red":this.specialClasses.has(`${s} ${i}`)?e.fillStyle="#ff7f00":e.fillStyle=p[this.sseq.classState.get(s,i)];let a=n.length;for(let n=0;n<a;n++){let[r,l]=this.sseqToCanvas(s,i,n,a);e.beginPath(),e.arc(r,l,.1*t,0,2*Math.PI),e.fill()}}e.restore()}_drawStructlines(e){for(let[t,s]of this.sseq.products){if(!this.visibleStructlines.has(t))continue;e.save();let i=this.structlineStyles.get(t);e.strokeStyle=i.color,e.setLineDash(i["line-dash"]);for(let t=this.xmin-1-s.x;t<this.xmax+1;t++)for(let n=this.ymin-1-s.y;n<this.ymax+1;n++){let r=s.matrices.get(t,n);if(null==r)continue;let l=r[Math.min(r.length-1,this.page-a.b)];if(void 0===l)continue;let o=l.length;if(0==o)continue;let h=l[0].length;if(0!=h)for(let a=0;a<o;a++)for(let r=0;r<h;r++)if(0!=l[a][r]){let[l,d]=this.sseqToCanvas(t,n,a,o),[c,u]=this.sseqToCanvas(t+s.x,n+s.y,r,h);if(e.beginPath(),0!=i.bend){let t=Math.sqrt((c-l)*(c-l)+(u-d)*(u-d)),s=.4,n=Math.atan((u-d)/(c-l)),a=-i.bend*Math.PI/180,r=l+Math.cos(n+a)*s*t,o=d+Math.sin(n+a)*s*t,h=c-Math.cos(n-a)*s*t,p=u-Math.sin(n-a)*s*t;e.moveTo(l,d),e.bezierCurveTo(r,o,h,p,c,u)}else e.moveTo(l,d),e.lineTo(c,u);e.stroke()}}e.restore()}}_drawDifferentials(e){e.save(),c[this.page-a.b]?e.strokeStyle=c[this.page-a.b]:e.strokeStyle=u;for(let t=this.xmin-1;t<this.xmax+2;t++)for(let s=this.ymin-1-this.page;s<this.ymax+1+this.page;s++){let i=this.sseq.getDifferentials(t,s,this.page);if(void 0===i)continue;let n=i.length;if(0==n)continue;let a=i[0].length;if(0!=a)for(let r=0;r<n;r++)for(let l=0;l<a;l++)if(0!=i[r][l]){let[i,o]=this.sseqToCanvas(t,s,r,n),[h,d]=this.sseqToCanvas(t-1,s+this.page,l,a);e.beginPath(),e.moveTo(i,o),e.lineTo(h,d),e.stroke()}}e.restore()}_onClick(e){if(!e)return;let t=this.selected;this.selected=null,this.sseq.hasClasses(...e,this.page)&&(this.selected=Array.from(e),this.highlightClass(this.selected)),t&&this.removeHighlight(t),this.emit("click",t),this.update()}_onMousemove(e){if(!this.xScale)return;let t,s=this.canvas.getBoundingClientRect();void 0!==(t=e?this.canvasToSseq(e.clientX-s.x,e.clientY-s.y):this.mouseCoord)&&(void 0!==this.mouseCoord&&(t[0]==this.mouseCoord[0]&&t[1]==this.mouseCoord[1]||void 0!==this.mouseCoord&&!this.sseq.hasClasses(...t,this.page)&&!this.sseq.hasClasses(...this.mouseCoord,this.page))||(this.mouseCoord&&this.removeHighlight(this.mouseCoord),this.mouseCoord=t,this.highlightClass(this.mouseCoord),this.sseq.hasClasses(t[0],t[1],this.page)?(this.tooltip.setHTML(`(${t[0]}, ${t[1]})`),this.tooltip.show(...this.sseqToCanvas(t[0],t[1]))):this.tooltip.hide(),this.update()))}toSVG(){let e=new C2S(this.canvasWidth,this.canvasHeight);return this._drawSseq(e),e.getSerializedSvg(!0)}downloadSVG(){let e=prompt("File name");null!==e&&((e=e.trim()).endsWith(".svg")||(e+=".svg"),Object(n.b)(e,this.toSVG(),"image/svg+xml"))}}class b{constructor(e){this.adjuster=document.createElement("div"),this.adjuster.style.height="100%",this.adjuster.style.cursor="ew-resize",this.adjuster.style.width="2px",e.appendChild(this.adjuster),this.resize=this.resize.bind(this),this.stopResize=this.stopResize.bind(this),this.adjuster.addEventListener("mousedown",function(e){e.preventDefault(),window.addEventListener("mousemove",this.resize),window.addEventListener("mouseup",this.stopResize)}.bind(this)),this.sidebar=document.createElement("div"),this.sidebar.style.width="250px",this.sidebar.style.display="flex",this.sidebar.style.flexDirection="column",this.sidebar.className="sidebar",e.appendChild(this.sidebar),this.mainDiv=document.createElement("div"),this.mainDiv.style.overflow="auto",this.mainDiv.style.flexGrow="1",this.sidebar.appendChild(this.mainDiv),this.footer_div=document.createElement("div"),this.sidebar.appendChild(this.footer_div),this.panels=[],this.currentPanel=null}addPanel(e){return this.panels.push(e),this.panels.length}init(e){this.display=e,this.footer=new i.c(this.footer_div,e)}resize(e){let t=this.sidebar.getBoundingClientRect().right-e.pageX;this.sidebar.style.width=`${t}px`}stopResize(){window.removeEventListener("mousemove",this.resize),window.removeEventListener("mouseup",this.stopResize),this.display.resize()}showPanel(e){e||(e=this.currentPanel),this.currentPanel=e;for(let t of this.panels)t==e?t.show():t.hide()}}class x extends v{constructor(e,t){"string"==typeof e&&(e=document.querySelector(e)),e.style.display="flex",e.style.displayDirection="row";let s=document.createElement("div");s.style.height="100%",s.style.minHeight="100%",s.style.overflow="hidden",s.style.position="relative",s.style.flexGrow="1",e.appendChild(s);let i=new b(e);super(s,t),this.sidebar=i,this.sidebar.init(this),Mousetrap.bind("left",this.previousPage),Mousetrap.bind("right",this.nextPage)}}class E extends x{constructor(e,t,s){super(e,t),this.isUnit=s,this.selected=null,this.on("mouseout",this._onMouseout.bind(this)),this.on("click",this.__onClick.bind(this)),this.generalPanel=new i.b(this.sidebar.mainDiv,this),this.sidebar.addPanel(this.generalPanel),this.sidebar.currentPanel=this.generalPanel,this.classPanel=new i.a(this.sidebar.mainDiv,this),this.sidebar.addPanel(this.classPanel),this.sidebar.footer.newGroup(),this.sidebar.footer.currentGroup.style.textAlign="center",this.runningSign=document.createElement("p"),this.runningSign.innerHTML="Running...",this.sidebar.footer.addObject(this.runningSign),this.sidebar.footer.addButtonRow([["Undo",()=>this.sseq.undo()],["Redo",()=>this.sseq.redo()]]),this.sidebar.footer.addButton("Download SVG",()=>this.downloadSVG()),this.sidebar.footer.addButton("Download Snapshots",()=>this.sseq.downloadHistoryList()),this.sidebar.footer.addButton("Save",()=>window.save()),Mousetrap.bind("J",()=>this.sidebar.currentPanel.prevTab()),Mousetrap.bind("K",()=>this.sidebar.currentPanel.nextTab()),Mousetrap.bind("d",()=>this.state=o),Mousetrap.bind("p",()=>{this.selected&&this.sseq.addPermanentClassInteractive(...this.selected)}),Mousetrap.bind("n",()=>{if(!this.selected)return;let[e,s]=this.selected,i=this.sseq.getClasses(e,s,a.b).length,n=0;if(1!=i)for(;;){if(null===(n=prompt("Class index")))return;if(n=parseInt(n),!(Number.isNaN(n)||n>=i||n<0))break;alert(`Invalid index. Enter integer between 0 and ${i} (inclusive)`)}let r=prompt("New class name");null!==r&&t.setClassName(e,s,n,r)}),t.on("update",(e,t)=>{this.selected&&this.selected[0]==e&&this.selected[1]==t&&this.sidebar.showPanel()})}_onMouseover(e){this.tooltip.setHTML(`(${e.x}, ${e.y})`),this.tooltip.show(e.canvas_x,e.canvas_y)}__onClick(e){if(this.state==h)return this.sseq.queryTable(...this.mouseCoord),void(this.state=null);if(this.selected){switch(this.state){case o:if(e&&e[0]==this.selected[0]+1&&this.selected[1]-e[1]>=a.b){this.sseq.addDifferentialInteractive(e,this.selected),this.state=null,this._onClick(e);break}}this.sidebar.showPanel(this.classPanel)}else this._unselect()}_onMouseout(){this.selected&&this.highlightClass(this.selected.x,this.selected.y),this.tooltip.hide()}_unselect(){this.selected=null,this.state=null,this.clearHighlight(),this.sidebar.showPanel(this.generalPanel),this.update()}setSseq(e){super.setSseq(e),e.on("new-structline",()=>{this.sidebar.showPanel()})}}class w extends v{constructor(e,t){super(e,t),document.querySelectorAll(".close-modal").forEach(e=>{e.addEventListener("click",this.closeModal.bind(this))}),document.querySelector("#modal-diff").addEventListener("click",()=>{document.querySelector("#modal-title").innerHTML="Select target element",this.state=o}),document.querySelector("#modal-ok").addEventListener("click",()=>{let[e,t]=this.selected,s=this.sseq.getClasses(e,t,a.b).length;window.mainSseq.addProductInteractive(e,t,s),this.closeModal()}),document.querySelector("#modal-more").addEventListener("click",()=>this.sseq.resolveFurther()),document.querySelector("#modal-more").addEventListener("mouseup",()=>document.querySelector("#modal-more").blur()),this.on("click",this.__onClick.bind(this))}openModal(){this._unselect(),this.sseq.resolveFurther(10),document.querySelector("#overlay").style.removeProperty("display"),document.querySelector("#modal-ok").disabled=!0,document.querySelector("#modal-diff").disabled=!0,document.querySelector("#unitsseq-dialog").classList.add("modal-shown")}closeModal(){document.querySelector("#overlay").style.display="none",document.querySelector("#unitsseq-dialog").classList.remove("modal-shown"),this.selected=null,this._unselect()}__onClick(e){if(this.selected){if(this.state==o)if(this.selected[0]==e[0]-1&&this.selected[1]-e[1]>=a.b){confirm(`Add differential from (${e[0]}, ${e[1]}) to (${this.selected[0]}, ${this.selected[1]})?`)&&(this.sseq.addProductDifferentialInteractive(e[0],e[1],this.selected[1]-e[1]),this.state=null,this.closeModal())}else alert("Invalid target for differential");else this.state=null;document.querySelector("#modal-ok").disabled=!1,document.querySelector("#modal-diff").disabled=!1}else this._unselect()}_unselect(){this.state=null,this.clearHighlight(),this.update(),document.querySelector("#modal-title").innerHTML="Select element to multiply with",document.querySelector("#modal-ok").disabled=!0,document.querySelector("#modal-diff").disabled=!0}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",function(){return Panel}),__webpack_require__.d(__webpack_exports__,"b",function(){return GeneralPanel}),__webpack_require__.d(__webpack_exports__,"a",function(){return ClassPanel});var _display_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_utils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),_sseq_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1);const ACTION_TO_DISPLAY={AddDifferential:(e,t)=>{let s=e.x,i=e.y,n=e.r,a=t.classNames.get(s,i),r=t.classNames.get(s-1,i+n);return[katex.renderToString(`d_{${n}}(${Object(_utils_js__WEBPACK_IMPORTED_MODULE_1__.j)(e.source,a)}) = ${Object(_utils_js__WEBPACK_IMPORTED_MODULE_1__.j)(e.target,r)}`),[[e.x,e.y],[e.x-1,e.y+e.r]]]},AddProductDifferential:(e,t)=>{let s=`\n<ul class="text-left" style="padding-left: 20px; list-style-type: none">\n  <li>\n    <details>\n      <summary>source: ${katex.renderToString(e.source.name)}</summary>\n      (${e.source.x}, ${e.source.y}): ${katex.renderToString(Object(_utils_js__WEBPACK_IMPORTED_MODULE_1__.i)(e.source.class))}\n    </details>\n  </li>\n  <li>\n    <details>\n      <summary>target: ${katex.renderToString(e.target.name)}</summary>\n      (${e.target.x}, ${e.target.y}): ${katex.renderToString(Object(_utils_js__WEBPACK_IMPORTED_MODULE_1__.i)(e.target.class))}\n    </details>\n  </li>\n</ul>`,i=`d_{${e.target.y-e.source.y}}(${e.source.name}) = ${e.target.name}`;return[`Propagate ${katex.renderToString(i)}`,[[e.source.x,e.source.y],[e.target.x,e.target.y]],t.isUnit?void 0:s]},AddProductType:(e,t)=>[`<span>${e.permanent?"Permanent p":"P"}roduct ${katex.renderToString(e.name)}</span>`,[[e.x,e.y]],t.isUnit?void 0:`(${e.x}, ${e.y}): ${katex.renderToString(Object(_utils_js__WEBPACK_IMPORTED_MODULE_1__.i)(e.class))}`],AddPermanentClass:(e,t)=>[`Permanent class ${katex.renderToString(Object(_utils_js__WEBPACK_IMPORTED_MODULE_1__.j)(e.class,t.classNames.get(e.x,e.y)))}`,[[e.x,e.y]]],SetClassName:(e,t)=>{let s=e.x,i=e.y,n=1==t.getClasses(s,i,_sseq_js__WEBPACK_IMPORTED_MODULE_2__.b)?`x_{${s},${i}}`:`x_{${s},${i}}^{(${e.idx})}`;return["Rename "+katex.renderToString(`${n} \\rightsquigarrow ${e.name}`),[[e.x,e.y]]]}};function msgToDisplay(e,t){if(!e)return["",[]];let s=e.action,i=Object.keys(s)[0],n=s[i];return ACTION_TO_DISPLAY[i](n,t)}class Panel extends EventEmitter{constructor(e,t){super(),this.display=t,this.container=document.createElement("div"),e.appendChild(this.container),this.links=[],this.currentGroup=this.container}hide(){this.container.style.display="none"}clear(){for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild);this.links=[]}show(){this.container.style.removeProperty("display");for(let e of this.links){let t=this.display;for(let s of e[0].split("."))if(null==(t=t[s]))return;e[1].value=t}this.emit("show")}newGroup(){this.currentGroup=document.createElement("div"),this.currentGroup.className="sidebar-group",this.container.appendChild(this.currentGroup)}endGroup(){this.currentGroup=this.container}addObject(e){this.currentGroup.appendChild(e)}addButton(e,t,s={},i=!0){let n=document.createElement("button");if(n.innerHTML=e,n.className="button",n.setAttribute("type","button"),n.style.flexGrow="1",n.addEventListener("click",t),n.addEventListener("mouseup",()=>n.blur()),s.tooltip&&n.setAttribute("title",s.tooltip),s.shortcuts)for(let e of s.shortcuts)Mousetrap.bind(e,t);if(i){let e=document.createElement("div");e.style.display="flex",e.appendChild(n),this.currentGroup.appendChild(e)}else this.currentGroup.appendChild(n);return n}addButtonRow(e){let t=this.currentGroup,s=document.createElement("div");s.className="button-row",this.currentGroup=s;let i=[];for(let t of e)2==t.length&&(t[2]=void 0),i.push(this.addButton(...t,!1));return this.currentGroup=t,this.currentGroup.appendChild(s),i}addHeader(e){let t=document.createElement("h5");t.innerHTML=e,this.addObject(t)}addLinkedInput(e,t,s){let i=document.createElement("div");i.className="input-row",this.currentGroup.appendChild(i);let n=document.createElement("label");n.innerHTML=e,i.appendChild(n);let a=document.createElement("input");a.setAttribute("type",s),i.appendChild(a),this.links.push([t,a]),a.addEventListener("change",e=>{let s=t.split("."),i=s.pop(),n=Panel.unwrapProperty(this.display,s),a=e.target.value;n[i]=a,this.display.sseq.emit("update")})}addLine(e,t,s){let i=document.createElement("div");i.style="padding: 0.75rem 0",i.innerHTML=e,t&&i.addEventListener("click",t),s&&(i.addEventListener("mouseover",()=>{i.style.color="blue";for(let e of s)this.display.highlightClass([e[0],e[1]]);this.display.update()}),i.addEventListener("mouseout",()=>{i.style.removeProperty("color"),this.display.clearHighlight(),this.display.update()})),this.addObject(i)}static unwrapProperty(e,t){let s=e;for(let e of t)s=s[e];return s}}class TabbedPanel extends Panel{constructor(e,t){super(e,t),this.head=document.createElement("div"),this.head.className="tab-header",this.container.appendChild(this.head),this.tabs=[],this.currentTab=null}addTab(e,t){let s=document.createElement("a");s.className="tab-header-item",s.href="#",s.innerHTML=e,this.head.appendChild(s),s.addEventListener("click",()=>this.showTab(t)),this.tabs[this.tabs.length]=[t,s],this.currentTab||(this.currentTab=t)}show(){super.show(),this.showTab(this.currentTab)}nextTab(){let e=this.tabs.findIndex(e=>e[0]==this.currentTab);e=(e+1)%this.tabs.length,this.showTab(this.tabs[e][0])}prevTab(){let e=this.tabs.findIndex(e=>e[0]==this.currentTab);e=(e+this.tabs.length-1)%this.tabs.length,this.showTab(this.tabs[e][0])}showTab(e){this.currentTab=e;for(let t of this.tabs)t[0]==e?(t[1].className="tab-header-item active",t[0].show()):(t[1].className="tab-header-item",t[0].hide())}}class GeneralPanel extends TabbedPanel{constructor(e,t){super(e,t),this.overviewTab=new OverviewPanel(this.container,this.display),this.addTab("Main",this.overviewTab),this.structlineTab=new StructlinePanel(this.container,this.display),this.addTab("Prod",this.structlineTab),this.historyTab=new HistoryPanel(this.container,this.display),this.addTab("Hist",this.historyTab)}}class HistoryPanel extends Panel{constructor(e,t){super(e,t),this.newGroup(),this.display.sseq.on("new-history",e=>this.addMessage(e)),this.display.sseq.on("clear-history",()=>{this.clear(),this.newGroup()})}show(){this.container.style.removeProperty("display"),this.clear(),this.newGroup();for(let e of this.display.sseq.history)this.addMessage(e)}addHistoryItem(e,t,s,i){let n,a;void 0===i?a=n=document.createElement("div"):(n=document.createElement("details"),a=document.createElement("summary"),n.appendChild(a)),n.className="history-item";let r=document.createElement("span");r.innerHTML=t,a.appendChild(r);let l=document.createElement("a");if(l.style.float="right",l.style.color="#dc3545",l.innerHTML="&times;",l.href="#",a.appendChild(l),l.addEventListener("click",()=>{this.display.clearHighlight(),this.display.sseq.removeHistoryItem(e)}),void 0!==i){let e=document.createElement("div");e.style.textAlign="center",e.innerHTML=i,n.appendChild(e)}this.addObject(n),n.addEventListener("mouseover",()=>{n.style="color: blue";for(let e of s)this.display.highlightClass([e[0],e[1]]);this.display.update()}),n.addEventListener("mouseout",()=>{n.style="",this.display.clearHighlight(),this.display.update()})}addMessage(e){let t=msgToDisplay(e,this.display.sseq);this.addHistoryItem(e,...t)}}class OverviewPanel extends Panel{constructor(e,t){super(e,t),this.newGroup(),this.addHeader("Vanishing line"),this.addLinkedInput("Slope","sseq.vanishingSlope","text"),this.addLinkedInput("Intercept","sseq.vanishingIntercept","text"),this.newGroup(),this.addButton("Query table",()=>this.display.state=_display_js__WEBPACK_IMPORTED_MODULE_0__.c,{shorcuts:["x"]}),this.addButton("Resolve further",()=>this.display.sseq.resolveFurther())}}class StructlinePanel extends Panel{constructor(e,t){super(e,t)}show(){this.container.style.removeProperty("display"),this.clear(),this.newGroup();let names=Array.from(this.display.sseq.products.keys()).sort();for(let name of names){let div=document.createElement("div");div.style.position="relative",this.addObject(div);let topElement=document.createElement("details");topElement.className="product-item",div.appendChild(topElement),topElement.addEventListener("toggle",()=>{if(topElement.open)for(let e of this.currentGroup.children)e!==topElement&&(e.open=!1)});let summary=document.createElement("summary");summary.className="product-summary",summary.style.width="100%",summary.addEventListener("mouseup",()=>summary.blur()),topElement.appendChild(summary);let l=document.createElement("label");l.innerHTML=katex.renderToString(name),summary.appendChild(l);let s=document.createElement("span");s.style.flexGrow=1,summary.appendChild(s);let i=document.createElement("label");i.className="switch";let checkbox=document.createElement("input");checkbox.setAttribute("type","checkbox"),checkbox.checked=this.display.visibleStructlines.has(name),i.appendChild(checkbox);let spn=document.createElement("span");spn.className="slider",i.appendChild(spn),div.appendChild(i),i.style.position="absolute",i.style.right="0px",i.style.top=summary.clientHeight-i.clientHeight+"px";let style=this.display.structlineStyles.get(name),styleDiv=document.createElement("div");styleDiv.style.paddingLeft="2.5%",styleDiv.style.marginLeft="2.5%",styleDiv.style.borderLeft="1.5px solid #DDD",topElement.appendChild(styleDiv);let cd=document.createElement("div");cd.className="input-row";let cl=document.createElement("label");cl.innerHTML="Color",cl.style.width="3rem",cd.appendChild(cl);let ci=document.createElement("input");ci.setAttribute("type","text"),ci.value=style.color,cd.appendChild(ci),ci.addEventListener("change",()=>{style.color=ci.value,this.display.update()}),styleDiv.appendChild(cd);let bd=document.createElement("div");bd.className="input-row";let bl=document.createElement("label");bl.innerHTML="Bend",bl.style.width="3rem",bd.appendChild(bl);let bi=document.createElement("input");bi.setAttribute("type","number"),bi.value=style.bend,bd.appendChild(bi),bi.addEventListener("change",()=>{style.bend=parseInt(bi.value),this.display.update()}),styleDiv.appendChild(bd);let dd=document.createElement("div");dd.className="input-row";let dl=document.createElement("label");dl.innerHTML="Dash",dl.style.width="3rem",dd.appendChild(dl);let di=document.createElement("input");di.setAttribute("type","text"),di.value="["+style["line-dash"].join(", ")+"]",di.title="An array of numbers that specify distances to alternately draw a line and a gap. For example, a solid line is [], while [2, 2] gives you a dashed line where the line and the gap have equal length.",dd.appendChild(di),di.addEventListener("change",()=>{style["line-dash"]=eval(di.value),this.display.update()}),styleDiv.appendChild(dd),checkbox.addEventListener("change",()=>{checkbox.checked?this.display.visibleStructlines.add(name):this.display.visibleStructlines.has(name)&&this.display.visibleStructlines.delete(name),this.display.update()})}this.display.isUnit||"CalculationDisplay"==this.display.constructor.name||this.addButton("Add",()=>window.unitDisplay.openModal(),{tooltip:"Add product to display"})}}class ClassPanel extends TabbedPanel{constructor(e,t){super(e,t),this.mainTab=new MainPanel(this.container,this.display),this.addTab("Main",this.mainTab),this.differentialTab=new DifferentialPanel(this.container,this.display),this.addTab("Diff",this.differentialTab),this.productsTab=new ProductsPanel(this.container,this.display),this.addTab("Prod",this.productsTab)}}class MainPanel extends Panel{constructor(e,t){super(e,t)}show(){if(!this.display.selected)return;this.container.style.removeProperty("display"),this.container.style.textAlign="center",this.clear(),this.newGroup(),this.addHeader("Classes");let[e,t]=this.display.selected,s=this.display.page,i=this.display.sseq,n=i.getClasses(e,t,s),a=i.classNames.get(e,t),r=document.createElement("div");for(let s of n){let l=document.createElement("span");l.style.padding="0 0.6em",l.innerHTML=katex.renderToString(Object(_utils_js__WEBPACK_IMPORTED_MODULE_1__.j)(s,a)),"CalculationDisplay"!=this.display.constructor.name&&n.length==i.classes.get(e,t)[0].length&&l.addEventListener("click",()=>{let n=prompt("New class name");null!==n&&i.setClassName(e,t,s.indexOf(1),n)}),r.appendChild(l)}this.addObject(r);let l=i.decompositions.get(e,t);if(l&&l.length>0){this.newGroup(),this.addHeader("Decompositions");for(let s of l){let n=1==s[0].reduce((e,t)=>e+t,0);n=n&&"CalculationDisplay"!=this.display.constructor.name;let r=[[e-s[2],t-s[3]]];if(this.display.isUnit&&(r[1]=[s[2],s[3]]),n){let n=s[0].indexOf(1);katex.renderToString(a[n])!=katex.renderToString(s[1])&&this.addLine(katex.renderToString(a[n]+" = "+s[1]),()=>{confirm(`Rename ${a[n]} as ${s[1]}?`)&&(i.setClassName(e,t,n,s[1]),this.display.clearHighlight())},r)}else this.addLine(katex.renderToString(Object(_utils_js__WEBPACK_IMPORTED_MODULE_1__.j)(s[0],a)+" = "+s[1]),void 0,r)}}this.display.isUnit&&"CalculationDisplay"!=this.display.constructor.name&&(this.newGroup(),this.addButton("Add Product",()=>{let[e,t]=this.display.selected,s=this.display.sseq.getClasses(e,t,_sseq_js__WEBPACK_IMPORTED_MODULE_2__.b).length;this.display.sseq.addProductInteractive(e,t,s)},{shortcuts:["m"]}))}}class DifferentialPanel extends Panel{constructor(e,t){super(e,t)}show(){this.container.style.removeProperty("display"),this.container.style.textAlign="center",this.clear();let[x,y]=this.display.selected,page=this.display.page,sseq=this.display.sseq;if("InProgress"==sseq.classState.get(x,y)){this.newGroup(),this.addHeader("Possible Differentials");let maxR=Math.ceil(eval(sseq.vanishingSlope)*x+eval(sseq.vanishingIntercept))-y,node=document.createElement("div");node.style.marginLeft="5%",node.style.marginRight="5%";for(let e=_sseq_js__WEBPACK_IMPORTED_MODULE_2__.b;e<=maxR;e++){let t=sseq.getClasses(x-1,y+e,e);if(t&&t.length>0&&(!sseq.trueDifferentials.get(x,y)||!sseq.trueDifferentials.get(x,y)[e-_sseq_js__WEBPACK_IMPORTED_MODULE_2__.b]||sseq.getClasses(x,y,e).length!=sseq.trueDifferentials.get(x,y)[e-_sseq_js__WEBPACK_IMPORTED_MODULE_2__.b].length)){let s=document.createElement("span");s.style.padding="0.4rem 0.75rem",s.style.display="inline-block",s.innerHTML=e,t=sseq.getClasses(x-1,y+e,page),s.addEventListener("mouseover",()=>{s.style.color="blue",this.display.highlightClass([x-1,y+e]),this.display.update()}),s.addEventListener("mouseout",()=>{s.style.removeProperty("color"),this.display.clearHighlight(),this.display.update()}),node.appendChild(s)}}node.hasChildNodes()||(node.innerHTML="No possible differentials!"),this.addObject(node)}this.newGroup(),this.addHeader("Differentials");let trueDifferentials=sseq.trueDifferentials.get(x,y);if(trueDifferentials&&trueDifferentials.length>page-_sseq_js__WEBPACK_IMPORTED_MODULE_2__.b)for(let[e,t]of trueDifferentials[page-_sseq_js__WEBPACK_IMPORTED_MODULE_2__.b]){let s;this.display.isUnit&&(s=()=>{let s=sseq.pageBasisToE2Basis(page,x,y,e),i=sseq.pageBasisToE2Basis(page,x-1,y+page,t);sseq.addProductDifferentialInteractive(x,y,page,s,i)}),this.addLine(katex.renderToString(`d_${page}(${Object(_utils_js__WEBPACK_IMPORTED_MODULE_1__.i)(e)}) = ${Object(_utils_js__WEBPACK_IMPORTED_MODULE_1__.i)(t)}`),s)}"CalculationDisplay"!=this.display.constructor.name&&(this.display.isUnit&&this.addLine("<span style='font-size: 80%'>Click differential to propagate</span>"),this.addButton("Add",()=>this.display.state=_display_js__WEBPACK_IMPORTED_MODULE_0__.b)),this.newGroup(),this.addHeader("Permanent Classes");let permanentClasses=sseq.permanentClasses.get(x,y);permanentClasses.length>0&&this.addLine(permanentClasses.map(_utils_js__WEBPACK_IMPORTED_MODULE_1__.h).join("<br />")),"CalculationDisplay"!=this.display.constructor.name&&this.addButton("Add",()=>{sseq.addPermanentClassInteractive(x,y)})}}class ProductsPanel extends Panel{constructor(e,t){super(e,t)}show(){this.container.style.removeProperty("display"),this.container.style.textAlign="center",this.clear();let[e,t]=this.display.selected,s=this.display.page,i=this.display.sseq;for(let[n,a]of i.products){let i=a.matrices.get(e,t);if(null==i)continue;let r=i[Math.min(i.length-1,s-_sseq_js__WEBPACK_IMPORTED_MODULE_2__.b)],l=document.createElement("div");l.style="padding: 0.75rem 0",l.addEventListener("mouseover",()=>{l.style="padding: 0.75rem 0; color: blue; font-weight: bold",this.display.highlightClass([e+a.x,t+a.y]),this.display.highlightClass([e-a.x,t-a.y]),this.display.update()}),l.addEventListener("mouseout",()=>{l.style="padding: 0.75rem 0",this.display.clearHighlight(),this.display.update()}),l.innerHTML=`${katex.renderToString(n)}: ${Object(_utils_js__WEBPACK_IMPORTED_MODULE_1__.d)(r)}`,this.addObject(l)}}addLine(e){let t=document.createElement("div");t.style="padding: 0.75rem 0",t.innerHTML=e,this.addObject(t)}}},function(e,t,s){"use strict";s.r(t);var i=s(2),n=s(1),a=s(0);window.resolutionWorker=new Worker("./resolution_worker.js"),window.sseqWorker=new Worker("./sseq_worker.js"),window.resolutionWorker.addEventListener("message",e=>window.sseqWorker.postMessage(e.data)),window.sseqWorker.addEventListener("message",e=>{let t=JSON.parse(e.data);try{let e=Object.keys(t.action)[0];if(d[e])d[e](t.action[e],t);else switch(t.sseq){case"Main":window.mainSseq["process"+e](t.action[e]);break;case"Unit":window.unitSseq["process"+e](t.action[e])}}catch(e){console.log("Unable to process message"),console.log(t),console.log(`Error: ${e}`)}}),window.commandCounter=0,window.commandQueue=[],window.onComplete=[];let r=new URL(document.location),l={};for(let[e,t]of r.searchParams.entries())l[e]=t;if(l.module){let e=parseInt(l.degree?l.degree:50);(async()=>{let t=await fetch(`modules/${l.module}.json`),s=await t.json();h([{recipients:["Resolver"],sseq:"Main",action:{ConstructJson:{algebra_name:"adem",data:JSON.stringify(s)}}},{recipients:["Resolver"],sseq:"Main",action:{Resolve:{max_degree:e}}}])})()}else{document.querySelector("#home").style.removeProperty("display"),HTMLCollection.prototype.forEach=Array.prototype.forEach,document.querySelector("#home").getElementsByTagName("section").forEach(e=>{e.children[1].children.forEach(e=>{"A"==e.tagName&&(e.innerHTML=Object(a.g)(e.innerHTML),e.href=`?module=${e.getAttribute("data")}&degree=50`)})})}function o(e){commandCounter+=e.recipients.length,void 0!==window.display&&display.runningSign.style.removeProperty("display");let t=JSON.stringify(e);for(let s of e.recipients)"Sseq"==s?window.sseqWorker.postMessage(t):window.resolutionWorker.postMessage(t)}function h(e,t){window.constructCommand=e[0];for(let t of e)o(t)}window.send=o,window.save=function(){let e=[window.constructCommand];e.push({recipients:["Resolver"],sseq:"Main",action:{Resolve:{max_degree:mainSseq.maxDegree}}}),!window.display.isUnit&&unitSseq.maxDegree>9&&e.push({recipients:["Resolver"],sseq:"Unit",action:{Resolve:{max_degree:unitSseq.maxDegree}}}),e=e.concat(mainSseq.history);let t=prompt("Input filename");Object(a.b)(t,e.map(JSON.stringify).join("\n"),"text/plain")};let d={Resolving:(e,t)=>{"Unit"!=t.sseq?(window.mainSseq||(window.mainSseq=new n.a("Main",e.min_degree),window.mainSseq.isUnit=e.is_unit,e.is_unit?window.unitSseq=window.mainSseq:(window.unitSseq=new n.a("Unit",0),unitSseq.maxDegree=9,Object.defineProperty(unitSseq,"maxX",{get:()=>Math.max(unitSseq.maxDegree,mainSseq.maxDegree)}),Object.defineProperty(unitSseq,"maxY",{get:()=>Math.min(unitSseq.maxDegree,Math.ceil(unitSseq.maxX/2+1))}))),window.mainSseq.processResolving(e),window.display||(e.is_unit?window.display=new i.a("#main",mainSseq,e.is_unit):(window.display=new i.a("#main",mainSseq,e.is_unit),window.unitDisplay=new i.d("#unitsseq-body",unitSseq)),window.display.runningSign.style.removeProperty("display"))):window.unitSseq.processResolving(e)}};d.Complete=function(e){if(commandCounter--,0==commandCounter){let e;for(display.runningSign.style.display="none",function(){if(0==commandQueue.length)return;let e="",t={recipients:["Resolver","Sseq"],action:{BlockRefresh:{block:!0}}};for(window.mainSseq.send(t),window.mainSseq.isUnit||window.unitSseq.send(t);commandQueue.length>0&&!e.includes('"Resolve"');)if(""!=(e=commandQueue.pop()).trim())try{let t=JSON.parse(e);"Main"==t.sseq?window.mainSseq.send(t):window.unitSseq.send(t)}catch(t){console.log("Unable to parse command "+e),console.log(t)}t.action.BlockRefresh.block=!1,window.mainSseq.send(t),window.mainSseq.isUnit||window.unitSseq.send(t)}();e=window.onComplete.pop();)e()}},d.QueryTableResult=function(e){console.log(`Table for (t - s, s) = (${e.t-e.s}, ${e.s}):`),console.log(e.string)},document.getElementById("json-upload").addEventListener("change",function(){let e=parseInt(prompt("Maximum degree",30).trim()),t=document.getElementById("json-upload").files[0],s=new FileReader;s.onload=t=>{h([{recipients:["Resolver"],sseq:"Main",action:{ConstructJson:{algebra_name:"adem",data:t.target.result}}},{recipients:["Resolver"],sseq:"Main",action:{Resolve:{max_degree:e}}}])},s.readAsText(t,"UTF-8"),document.querySelector("#home").style.display="none"}),document.getElementById("history-upload").addEventListener("change",function(){let e=document.getElementById("history-upload").files[0],t=new FileReader;t.onload=async e=>{let t=e.target.result.split("\n"),s=JSON.parse(t[0]);if(s.action.Construct){let e=s.action.Construct.module_name,i=await fetch(`modules/${e}.json`),n=await i.json();s.action={ConstructJson:{algebra_name:"adem",data:JSON.stringify(n)}},t[0]=JSON.stringify(s)}h(t.splice(0,2).map(JSON.parse)),t.reverse(),window.commandQueue=t},t.readAsText(e,"UTF-8"),document.querySelector("#home").style.display="none"})}]);